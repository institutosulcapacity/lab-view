<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Laboratório Virtual – Comandos Elétricos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  background:#1e1e1e;
  color:#fff;
  font-family:Arial, sans-serif;
  text-align:center;
}

h1{
  margin:20px 0;
}

svg{
  background:#2b2b2b;
  border-radius:14px;
}

.borne{
  fill:#111;
  stroke:#fff;
  stroke-width:2;
  cursor:pointer;
}

.borne:hover{
  fill:#3498db;
}

.fio{
  stroke:#f1c40f;
  stroke-width:5;
}

.label{
  font-size:12px;
  fill:#000;
  pointer-events:none;
}
</style>
</head>

<body>

<h1>Laboratório Virtual – Montagem de Comandos Elétricos</h1>

<svg id="painel" width="420" height="540">

  <!-- DISJUNTOR -->
  <g>
    <rect x="120" y="20" width="180" height="70" rx="8"
          fill="#e6e6e6" stroke="#888" stroke-width="2"/>
    <rect x="200" y="40" width="20" height="30" rx="3"
          fill="#333"/>
    <text x="210" y="95" text-anchor="middle" class="label">DISJUNTOR</text>
    <circle cx="210" cy="105" r="6"
            class="borne" data-id="disjuntor_out"/>
  </g>

  <!-- CONTATOR -->
  <g>
    <rect x="110" y="130" width="200" height="80" rx="8"
          fill="#dcdcdc" stroke="#777" stroke-width="2"/>
    <text x="210" y="160" text-anchor="middle" class="label">CONTATOR</text>
    <circle cx="210" cy="125" r="6"
            class="borne" data-id="contator_in"/>
    <circle cx="210" cy="215" r="6"
            class="borne" data-id="contator_out"/>
  </g>

  <!-- TEMPORIZADOR -->
  <g>
    <rect x="110" y="250" width="200" height="80" rx="8"
          fill="#f0f0f0" stroke="#777" stroke-width="2"/>
    <circle cx="210" cy="290" r="18"
            fill="#fff" stroke="#333" stroke-width="2"/>
    <text x="210" y="295" text-anchor="middle" font-size="10">⏱</text>
    <text x="210" y="345" text-anchor="middle" class="label">TEMPORIZADOR</text>
    <circle cx="210" cy="245" r="6"
            class="borne" data-id="temporizador_in"/>
    <circle cx="210" cy="335" r="6"
            class="borne" data-id="temporizador_out"/>
  </g>

  <!-- MOTOR -->
  <g>
    <rect x="110" y="380" width="200" height="70" rx="35"
          fill="#bfbfbf" stroke="#555" stroke-width="2"/>
    <text x="210" y="420" text-anchor="middle" class="label">MOTOR</text>
    <circle cx="210" cy="375" r="6"
            class="borne" data-id="motor_in"/>
  </g>

</svg>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const svg = document.getElementById("painel");
  let fioAtual = null;
  let origem = null;

  const bornesOcupados = {};

  const ligacoesValidas = {
    disjuntor_out: "contator_in",
    contator_out: "temporizador_in",
    temporizador_out: "motor_in"
  };

  svg.addEventListener("mousedown", e => {
    if(e.target.classList.contains("borne")){
      const id = e.target.dataset.id;
      if(bornesOcupados[id]){
        alert("Este borne já está conectado");
        return;
      }
      origem = e.target;
      fioAtual = document.createElementNS("http://www.w3.org/2000/svg","line");
      fioAtual.setAttribute("x1", origem.cx.baseVal.value);
      fioAtual.setAttribute("y1", origem.cy.baseVal.value);
      fioAtual.setAttribute("x2", origem.cx.baseVal.value);
      fioAtual.setAttribute("y2", origem.cy.baseVal.value);
      fioAtual.setAttribute("class","fio");
      svg.appendChild(fioAtual);
    }
  });

  svg.addEventListener("mousemove", e => {
    if(fioAtual){
      const pt = svg.createSVGPoint();
      pt.x = e.clientX;
      pt.y = e.clientY;
      const pos = pt.matrixTransform(svg.getScreenCTM().inverse());
      fioAtual.setAttribute("x2", pos.x);
      fioAtual.setAttribute("y2", pos.y);
    }
  });

  svg.addEventListener("mouseup", e => {
    if(!fioAtual) return;

    if(e.target.classList.contains("borne") && e.target !== origem){
      const origemId = origem.dataset.id;
      const destinoId = e.target.dataset.id;

      if(bornesOcupados[destinoId]){
        alert("Este borne já está conectado");
        fioAtual.remove();
      }
      else if(ligacoesValidas[origemId] === destinoId){
        fioAtual.setAttribute("x2", e.target.cx.baseVal.value);
        fioAtual.setAttribute("y2", e.target.cy.baseVal.value);
        bornesOcupados[origemId] = true;
        bornesOcupados[destinoId] = true;
      }
      else{
        alert("Ligação elétrica incorreta");
        fioAtual.remove();
      }
    } else {
      fioAtual.remove();
    }

    fioAtual = null;
    origem = null;
  });

});
</script>

</body>
</html>
